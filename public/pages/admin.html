<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>CheatLibrary.xyz | Admin Dashboard</title>
        <!-- Favicon -->
    <link rel="icon" href="https://files.catbox.moe/ehv4yb.jpg" type="image/x-icon" />
    <link rel="shortcut icon" href="https://files.catbox.moe/ehv4yb.jpg" type="image/x-icon" />
  
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
          colors: { 
            brand: '#6366f1', 
            brandDark: '#4f46e5',
            surface: '#ffffff',
            surfaceDark: '#1e293b',
            bgDark: '#0f172a'
          }
        }
      }
    }
  </script>

  <style>
    body { font-size: 0.95rem; }
    .glass-effect {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }
    .dark .glass-effect {
      background: rgba(30, 41, 59, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    .dark ::-webkit-scrollbar-thumb { background: #475569; }
    
    .input-field {
      @apply w-full px-4 py-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-slate-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-brand/50 transition-all;
    }
    .label-text {
      @apply block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2;
    }
  </style>
</head>
<body class="bg-gray-100 dark:bg-bgDark text-gray-900 dark:text-white transition-colors duration-300 min-h-screen">

  <div id="loginOverlay" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-100 dark:bg-bgDark p-4">
    <div class="w-full max-w-md bg-white dark:bg-surfaceDark rounded-3xl shadow-2xl p-8 text-center animate-in fade-in zoom-in duration-300">
      <div class="w-16 h-16 bg-brand/10 text-brand rounded-2xl flex items-center justify-center mx-auto mb-6">
        <i data-lucide="lock" class="w-8 h-8"></i>
      </div>
      <h1 class="text-2xl font-extrabold mb-2">Admin Access</h1>
      <p class="text-gray-500 text-sm mb-6">Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u qu·∫£n tr·ªã ƒë·ªÉ ti·∫øp t·ª•c</p>
      
      <input type="password" id="password" placeholder="M·∫≠t kh·∫©u..." class="input-field text-center text-lg mb-4" onkeypress="if(event.key==='Enter') checkPassword()">
      
      <button onclick="checkPassword()" class="w-full py-3.5 rounded-xl bg-brand hover:bg-brandDark text-white font-bold shadow-lg shadow-brand/30 transition-all active:scale-95">
        ƒêƒÉng Nh·∫≠p
      </button>
      <p id="loginMsg" class="mt-4 text-sm font-medium text-red-500 hidden"></p>
    </div>
  </div>

  <div id="dashboard" class="hidden max-w-5xl mx-auto p-4 md:p-8 pb-20">
    
    <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
      <div>
        <h1 class="text-3xl font-black bg-gradient-to-r from-brand to-purple-500 bg-clip-text text-transparent">Dashboard</h1>
        <p class="text-gray-500 dark:text-gray-400 text-sm">Qu·∫£n l√Ω n·ªôi dung ·ª©ng d·ª•ng & h·ªá th·ªëng</p>
      </div>
      <div class="flex gap-3">
        <button onclick="logout()" class="px-4 py-2 rounded-lg bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 font-bold text-sm hover:bg-red-100 transition flex items-center gap-2">
          <i data-lucide="log-out" class="w-4 h-4"></i> Tho√°t
        </button>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <div class="md:col-span-2 bg-white dark:bg-surfaceDark rounded-3xl p-6 shadow-sm border border-gray-100 dark:border-white/5 relative overflow-hidden">
        <div class="absolute top-0 right-0 w-32 h-32 bg-brand/10 rounded-full blur-3xl -mr-10 -mt-10"></div>
        
        <div class="flex justify-between items-start mb-4 relative z-10">
          <div>
            <h3 class="text-lg font-bold flex items-center gap-2">
              <i data-lucide="refresh-cw" class="w-5 h-5 text-brand"></i> Auto-Sync IPA
            </h3>
            <p class="text-xs text-gray-500 mt-1">ƒê·ªìng b·ªô d·ªØ li·ªáu t·ª± ƒë·ªông t·ª´ AppTesters</p>
          </div>
          <span class="px-3 py-1 rounded-full bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 text-xs font-bold flex items-center gap-1">
            <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span> Active
          </span>
        </div>

        <div class="flex gap-3 mt-4 relative z-10">
          <button onclick="syncIPA(false)" id="syncBtn" class="flex-1 py-2.5 rounded-xl bg-brand text-white font-bold text-sm shadow-md hover:bg-brandDark transition flex items-center justify-center gap-2">
            <i data-lucide="download-cloud" class="w-4 h-4"></i> Sync H√¥m Nay
          </button>
          <button onclick="syncIPA(true)" id="forceSyncBtn" class="px-4 py-2.5 rounded-xl bg-gray-100 dark:bg-white/5 text-gray-700 dark:text-gray-300 font-bold text-sm hover:bg-gray-200 dark:hover:bg-white/10 transition" title="Force Full Sync">
            <i data-lucide="database" class="w-4 h-4"></i>
          </button>
        </div>
        <p id="syncStatus" class="mt-3 text-xs text-center font-medium h-4"></p>
      </div>

      <div class="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-3xl p-6 text-white shadow-lg shadow-indigo-500/20 flex flex-col justify-center">
        <h3 class="text-lg font-bold mb-1">Upload M·ªõi</h3>
        <p class="text-indigo-100 text-xs mb-4">Ch·ªçn lo·∫°i n·ªôi dung c·∫ßn ƒëƒÉng t·∫£i</p>
        
        <div class="grid grid-cols-3 gap-2">
           <button onclick="setFormType('ipa')" class="type-btn active bg-white/20 hover:bg-white/30 p-2 rounded-lg text-xs font-bold backdrop-blur-sm transition" data-type="ipa">IPA</button>
           <button onclick="setFormType('cert')" class="type-btn bg-white/10 hover:bg-white/30 p-2 rounded-lg text-xs font-bold backdrop-blur-sm transition" data-type="cert">Cert</button>
           <button onclick="setFormType('mod')" class="type-btn bg-white/10 hover:bg-white/30 p-2 rounded-lg text-xs font-bold backdrop-blur-sm transition" data-type="mod">Mod</button>
           <button onclick="setFormType('sign')" class="type-btn bg-white/10 hover:bg-white/30 p-2 rounded-lg text-xs font-bold backdrop-blur-sm transition" data-type="sign">Sign</button>
           <button onclick="setFormType('dylib')" class="type-btn bg-white/10 hover:bg-white/30 p-2 rounded-lg text-xs font-bold backdrop-blur-sm transition" data-type="dylib">Dylib</button>
           <button onclick="setFormType('conf')" class="type-btn bg-white/10 hover:bg-white/30 p-2 rounded-lg text-xs font-bold backdrop-blur-sm transition" data-type="conf">Conf</button>
        </div>
      </div>
    </div>

    <div class="bg-white dark:bg-surfaceDark rounded-3xl p-6 md:p-8 shadow-sm border border-gray-100 dark:border-white/5">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-bold flex items-center gap-2">
          <span id="formTitleIcon" class="p-2 rounded-lg bg-brand/10 text-brand"><i data-lucide="upload" class="w-5 h-5"></i></span>
          <span id="formTitleText">Upload IPA</span>
        </h2>
        <input type="hidden" id="currentType" value="ipa">
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="space-y-4">
          <div>
            <label class="label-text" id="lbl-name">T√™n ·ª©ng d·ª•ng</label>
            <input type="text" id="inp-name" class="input-field" placeholder="Nh·∫≠p t√™n...">
          </div>
          
          <div>
            <label class="label-text">Link Icon</label>
            <div class="flex gap-3">
               <input type="text" id="inp-icon" class="input-field" placeholder="https://..." oninput="updatePreview()">
               <img id="preview-icon" src="https://placehold.co/100" class="w-12 h-12 rounded-xl bg-gray-100 object-cover border border-gray-200 dark:border-gray-700">
            </div>
          </div>

          <div>
            <label class="label-text" id="lbl-link">Link T·∫£i (Download/File)</label>
            <input type="text" id="inp-link" class="input-field" placeholder="https://...">
          </div>

          <div id="field-version-group">
            <label class="label-text" id="lbl-version">Phi√™n b·∫£n</label>
            <input type="text" id="inp-version" class="input-field" placeholder="1.0.0">
          </div>
        </div>

        <div class="space-y-4">
          <div id="field-desc-group">
            <label class="label-text">M√¥ t·∫£ / Ghi ch√∫</label>
            <textarea id="inp-desc" rows="3" class="input-field resize-none" placeholder="Nh·∫≠p m√¥ t·∫£ ng·∫Øn..."></textarea>
          </div>

          <div id="field-extra-group">
             <label class="label-text" id="lbl-extra">Nh√† ph√°t tri·ªÉn</label>
             <input type="text" id="inp-extra" class="input-field" placeholder="T√™n dev...">
          </div>

          <div id="field-tags-group">
            <label class="label-text">Th·∫ª (Tags) - ƒê√£ c·∫≠p nh·∫≠t</label>
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
              <label class="cursor-pointer select-none"><input type="checkbox" class="peer hidden" name="tags" value="game"><span class="block text-center px-3 py-1.5 rounded-lg bg-gray-100 dark:bg-white/5 peer-checked:bg-brand peer-checked:text-white text-xs font-bold transition">üéÆ Game</span></label>
              <label class="cursor-pointer select-none"><input type="checkbox" class="peer hidden" name="tags" value="social"><span class="block text-center px-3 py-1.5 rounded-lg bg-gray-100 dark:bg-white/5 peer-checked:bg-brand peer-checked:text-white text-xs font-bold transition">üí¨ Social</span></label>
              <label class="cursor-pointer select-none"><input type="checkbox" class="peer hidden" name="tags" value="photo/video"><span class="block text-center px-3 py-1.5 rounded-lg bg-gray-100 dark:bg-white/5 peer-checked:bg-brand peer-checked:text-white text-xs font-bold transition">üì∏ Photo/Video</span></label>
              <label class="cursor-pointer select-none"><input type="checkbox" class="peer hidden" name="tags" value="music"><span class="block text-center px-3 py-1.5 rounded-lg bg-gray-100 dark:bg-white/5 peer-checked:bg-brand peer-checked:text-white text-xs font-bold transition">üéµ Music</span></label>
              <label class="cursor-pointer select-none"><input type="checkbox" class="peer hidden" name="tags" value="utility"><span class="block text-center px-3 py-1.5 rounded-lg bg-gray-100 dark:bg-white/5 peer-checked:bg-brand peer-checked:text-white text-xs font-bold transition">üõ†Ô∏è Utility</span></label>
              <label class="cursor-pointer select-none"><input type="checkbox" class="peer hidden" name="tags" value="productivity"><span class="block text-center px-3 py-1.5 rounded-lg bg-gray-100 dark:bg-white/5 peer-checked:bg-brand peer-checked:text-white text-xs font-bold transition">üìä Productivity</span></label>
            </div>
          </div>

          <div>
            <label class="label-text">Nh√£n (Badge)</label>
            <div class="flex flex-wrap gap-2">
              <label class="cursor-pointer select-none"><input type="radio" class="peer hidden" name="badge" value="" checked><span class="px-3 py-1.5 rounded-lg border border-gray-200 dark:border-gray-700 peer-checked:border-brand peer-checked:text-brand text-xs font-bold transition">None</span></label>
              <label class="cursor-pointer select-none"><input type="radio" class="peer hidden" name="badge" value="new"><span class="px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-500 peer-checked:bg-blue-500 peer-checked:text-white text-xs font-bold transition">M·ªõi</span></label>
              <label class="cursor-pointer select-none"><input type="radio" class="peer hidden" name="badge" value="hot"><span class="px-3 py-1.5 rounded-lg bg-orange-500/10 text-orange-500 peer-checked:bg-orange-500 peer-checked:text-white text-xs font-bold transition">Hot</span></label>
              <label class="cursor-pointer select-none"><input type="radio" class="peer hidden" name="badge" value="vip"><span class="px-3 py-1.5 rounded-lg bg-yellow-500/10 text-yellow-500 peer-checked:bg-yellow-500 peer-checked:text-white text-xs font-bold transition">VIP</span></label>
              <label class="cursor-pointer select-none"><input type="radio" class="peer hidden" name="badge" value="trending"><span class="px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-500 peer-checked:bg-purple-500 peer-checked:text-white text-xs font-bold transition">Trending</span></label>
            </div>
          </div>
        </div>
      </div>

      <hr class="my-6 border-gray-100 dark:border-white/5">

      <div class="flex justify-end gap-3">
        <button onclick="resetForm()" class="px-6 py-3 rounded-xl font-bold text-gray-500 hover:bg-gray-100 dark:hover:bg-white/5 transition">L√†m m·ªõi</button>
        <button onclick="submitForm()" id="submitBtn" class="px-8 py-3 rounded-xl bg-brand text-white font-bold shadow-lg shadow-brand/30 hover:bg-brandDark hover:scale-[1.02] transition flex items-center gap-2">
          <i data-lucide="upload-cloud" class="w-5 h-5"></i> ƒêƒÉng T·∫£i
        </button>
      </div>
      <p id="uploadMsg" class="text-center mt-4 text-sm font-semibold"></p>
    </div>

  </div>

  <script>
    // === AUTH ===
    async function checkAuth() {
        try {
            const res = await fetch('/api/auth/verify', { method: 'POST', body: JSON.stringify({}) });
            if(res.ok) showDashboard();
        } catch(e) {}
    }
    
    async function checkPassword() {
        const p = document.getElementById('password').value;
        const msg = document.getElementById('loginMsg');
        try {
            const res = await fetch('/api/auth/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({password: p})
            });
            const d = await res.json();
            if(d.success) {
                showDashboard();
            } else {
                msg.textContent = '‚ùå M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng';
                msg.classList.remove('hidden');
            }
        } catch(e) { msg.textContent = '‚ùå L·ªói k·∫øt n·ªëi'; msg.classList.remove('hidden'); }
    }

    function showDashboard() {
        document.getElementById('loginOverlay').classList.add('hidden');
        document.getElementById('dashboard').classList.remove('hidden');
        document.getElementById('dashboard').classList.add('animate-in', 'fade-in', 'slide-in-from-bottom-4');
    }

    function logout() {
        document.cookie = "admin_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        window.location.reload();
    }

    // === UI LOGIC ===
    const CONFIG = {
        ipa: { title: 'Upload IPA', lblName: 'T√™n App', lblExtra: 'Nh√† ph√°t tri·ªÉn', hasTags: true },
        dylib: { title: 'Upload Dylib', lblName: 'T√™n Dylib', lblExtra: 'Nh√† ph√°t tri·ªÉn', hasTags: true },
        conf: { title: 'Upload Conf', lblName: 'T√™n C·∫•u h√¨nh', lblExtra: 'T√°c gi·∫£', hasTags: true },
        sign: { title: 'ƒêƒÉng Sign M·ªõi', lblName: 'T√™n ·ª®ng d·ª•ng', lblExtra: 'Ng√†y c·∫≠p nh·∫≠t', lblVer: 'K√≠ch th∆∞·ªõc (Size)', hasTags: false },
        cert: { title: 'ƒêƒÉng Cert M·ªõi', lblName: 'T√™n File', lblExtra: 'T√™n Ch·ª©ng Ch·ªâ (CN)', lblVer: 'Tr·∫°ng th√°i (Check)', hasTags: false },
        mod: { title: 'ƒêƒÉng Mod Hot', lblName: 'T√™n Mod', lblExtra: 'Tag (VD: Gold)', lblVer: 'Phi√™n b·∫£n', hasTags: false }
    };

    function setFormType(type) {
        document.querySelectorAll('.type-btn').forEach(b => {
            b.classList.remove('bg-white/20', 'active');
            b.classList.add('bg-white/10');
            if(b.dataset.type === type) {
                b.classList.add('bg-white/20', 'active');
                b.classList.remove('bg-white/10');
            }
        });

        const cfg = CONFIG[type];
        document.getElementById('currentType').value = type;
        document.getElementById('formTitleText').textContent = cfg.title;
        
        document.getElementById('lbl-name').textContent = cfg.lblName;
        document.getElementById('lbl-extra').textContent = cfg.lblExtra;
        
        // Show/Hide Tags based on type
        document.getElementById('field-tags-group').style.display = cfg.hasTags ? 'block' : 'none';

        // Adjust Version/Extra fields based on type
        const lblVer = document.getElementById('lbl-version');
        const inpVer = document.getElementById('inp-version');
        const inpExtra = document.getElementById('inp-extra');

        if(type === 'cert') {
            lblVer.textContent = 'Tr·∫°ng th√°i (Check)'; // ex: üü¢ Good
            inpVer.placeholder = 'VD: üü¢ Good';
            inpExtra.placeholder = 'VD: China Mobile...';
        } else if (type === 'sign') {
            lblVer.textContent = 'K√≠ch th∆∞·ªõc (Size)';
            inpVer.placeholder = 'VD: 150 MB';
            inpExtra.placeholder = 'VD: 2024-12-05 (ƒê·ªÉ tr·ªëng l·∫•y ng√†y hi·ªán t·∫°i)';
        } else if (type === 'mod') {
            lblVer.textContent = 'Phi√™n b·∫£n';
            inpVer.placeholder = 'VD: 1.0.5';
            inpExtra.placeholder = 'VD: Gold / VIP';
        } else {
            lblVer.textContent = 'Phi√™n b·∫£n';
            inpVer.placeholder = 'VD: 1.0.0';
            inpExtra.placeholder = 'VD: Dev Name';
        }
    }

    function updatePreview() {
        const url = document.getElementById('inp-icon').value;
        if(url) document.getElementById('preview-icon').src = url;
    }

  // === SUBMIT LOGIC (ƒê√É C·∫¨P NH·∫¨T) ===
    async function submitForm() {
        const type = document.getElementById('currentType').value;
        const name = document.getElementById('inp-name').value.trim();
        const icon = document.getElementById('inp-icon').value.trim();
        const link = document.getElementById('inp-link').value.trim();
        const version = document.getElementById('inp-version').value.trim();
        const desc = document.getElementById('inp-desc').value.trim();
        const extra = document.getElementById('inp-extra').value.trim(); // Developer / Date / CertName / ModTag
        
        // Get Badge
        const badgeEl = document.querySelector('input[name="badge"]:checked');
  const badge = badgeEl ? badgeEl.value : '';

        // Get Tags
        const tags = [];
        document.querySelectorAll('input[name="tags"]:checked').forEach(c => tags.push(c.value));

  // Validate c∆° b·∫£n
        if(!name || !link) {
            alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p √≠t nh·∫•t T√™n v√† Link t·∫£i!');
            return;
        }

        const btn = document.getElementById('submitBtn');
        const msg = document.getElementById('uploadMsg');
        
  // UI Loading
  btn.disabled = true;
  const originBtnContent = btn.innerHTML;
  btn.innerHTML = '<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i> ƒêang x·ª≠ l√Ω...';
  lucide.createIcons();
  msg.textContent = '';

        // Construct Data Object based on Type
        let appData = {
            id: `${type}-${Date.now()}`,
            type: type,
            date: new Date().toISOString().split('T')[0] // Default date
        };

        if (['ipa', 'dylib', 'conf'].includes(type)) {
            appData.name = name;
            appData.icon = icon;
            appData.desc = desc;
            appData.version = version;
            appData.developer = extra;
            appData.tags = tags;
            appData.badge = badge;
            if (type === 'conf') appData.link = link; 
            else appData.fileLink = link;
      if (type === 'conf') appData.usage = desc; 
    } 
    else if (type === 'cert') {
      appData.filename = name;
      appData.check = version || 'üü¢ Good'; 
      appData.certname = extra || 'Unknown'; 
      appData.size = desc; 
            appData.downloadUrl = link;
            appData.iconUrl = icon;
            appData.tag = badge ? badge.toUpperCase() : 'NEW';
        } 
        else if (type === 'mod') {
      appData.title = name;
      appData.version = version;
      appData.description = desc; 
      appData.downloadUrl = link;
      appData.iconUrl = icon;
      appData.tag = extra || badge || 'MOD'; 
    } 
    else if (type === 'sign') {
      appData.title = name;
      appData.description = desc;
      appData.size = version; 
      appData.date = extra || appData.date; 
            appData.downloadUrl = link;
            appData.iconUrl = icon;
            appData.tag = badge ? badge.toUpperCase() : 'NEW';
        }

        try {
            const res = await fetch('/api/upload', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ type, data: appData })
            });
            
      let result;
      try {
        result = await res.json();
      } catch (jsonErr) {
        throw new Error('Server tr·∫£ v·ªÅ d·ªØ li·ªáu kh√¥ng h·ª£p l·ªá.');
      }

      if(res.ok) {
        msg.innerHTML = `‚úÖ Upload th√†nh c√¥ng!<br><span class="text-xs font-normal text-gray-500">Path: ${result.path}</span>`;
                msg.className = 'mt-4 text-center text-sm font-bold text-green-500';
                setTimeout(() => { 
                    msg.textContent = ''; 
                    resetForm();
                }, 3000);
            } else {
                if(result.code === 'NO_AUTH_COOKIE') {
                    msg.textContent = '‚ö†Ô∏è H·∫øt phi√™n ƒëƒÉng nh·∫≠p. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.';
                    logout();
                } else {
                    msg.textContent = '‚ùå L·ªói: ' + (result.error || 'Unknown');
                }
                msg.className = 'mt-4 text-center text-sm font-bold text-red-500';
            }
        } catch(e) {
            console.error(e);
            msg.textContent = '‚ùå L·ªói k·∫øt n·ªëi: ' + e.message;
            msg.className = 'mt-4 text-center text-sm font-bold text-red-500';
        } finally {
            btn.disabled = false;
            btn.innerHTML = originBtnContent;
            lucide.createIcons();
        }
    }

    function resetForm() {
        document.getElementById('inp-name').value = '';
        document.getElementById('inp-icon').value = '';
        document.getElementById('inp-link').value = '';
        document.getElementById('inp-version').value = '';
        document.getElementById('inp-desc').value = '';
        document.getElementById('inp-extra').value = '';
        document.getElementById('preview-icon').src = 'https://placehold.co/100';
        
        document.querySelectorAll('input[name="tags"]').forEach(c => c.checked = false);
        document.querySelector('input[name="badge"][value=""]').checked = true;
    }

    // === SYNC LOGIC ===
    async function syncIPA(force) {
        const btn = document.getElementById(force ? 'forceSyncBtn' : 'syncBtn');
        const status = document.getElementById('syncStatus');
        const originContent = btn.innerHTML;
        
        btn.disabled = true;
        btn.innerHTML = '<i data-lucide="loader" class="w-4 h-4 animate-spin"></i>';
        lucide.createIcons();
        status.className = 'mt-3 text-xs text-center font-medium h-4 text-gray-500';
        status.textContent = 'ƒêang ƒë·ªìng b·ªô...';

        try {
            const res = await fetch('/api/sync-ipa', { method: 'POST' });
            const data = await res.json();
            
            if(res.ok) {
                status.className = 'mt-3 text-xs text-center font-bold h-4 text-green-500';
                status.textContent = `‚úÖ Th√†nh c√¥ng! +${data.stats?.new || 0} App m·ªõi`;
            } else {
                status.className = 'mt-3 text-xs text-center font-bold h-4 text-red-500';
                status.textContent = '‚ùå L·ªói: ' + (data.error || 'Unknown');
            }
        } catch(e) {
            status.className = 'mt-3 text-xs text-center font-bold h-4 text-red-500';
            status.textContent = '‚ùå L·ªói k·∫øt n·ªëi';
        } finally {
            setTimeout(() => {
                btn.disabled = false;
                btn.innerHTML = originContent;
                lucide.createIcons();
            }, 1000);
        }
    }

    // INIT
    checkAuth();
    setFormType('ipa');
    lucide.createIcons();
  </script>
</body>
</html>
